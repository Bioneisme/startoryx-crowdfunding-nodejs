<!DOCTYPE html>
<html lang="en">
<head>
    <title>Startoryx <%= user.nickname %></title>
    <%- include('../partials/head'); %>
</head>
<body>

<header id="header" style="background-color: #03045E">
    <%- include('../partials/header'); %>
</header>

<!--PRIVATE-->
<div class="container profile_div text-center ">
    <div class="row">
        <div class="col-4 text-center profile_photo_div">
            <img data-bs-toggle="modal" data-bs-target="#changePhoto" src="<%= user.image %>"
                 class="rounded-3 profile_photo">
            <% if (isOwner) { %>
                <div>
                    <h4>Change photo</h4>
                </div>
            <% } %>
        </div>
        <div class="col-8 py-auto">
            <div class="row ">
                <div class="col-6 my-1">
                    <div class="row text-xl-start text-center">
                        <div class="col-12 profile_type">Name</div>
                        <div class="col-12 profile_content"><%= user.first_name %> <%= user.last_name %></div>
                    </div>
                    <div class="row text-xl-start text-center">
                        <div class="col-12 profile_type">Nickname</div>
                        <div class="col-12 profile_content"><%= user.nickname %></div>
                    </div>
                    <div class="row text-xl-start text-center">
                        <div class="col-12 profile_type">Age</div>
                        <div class="col-12 profile_content"><%= user.age %></div>
                    </div>
                    <div class="row text-xl-start text-center">
                        <div class="col-12 profile_type">Specialist</div>
                        <div class="col-12 profile_content"><%= user.specialist %></div>
                    </div>
                </div>
                <% if (isOwner) { %>
                    <div class="col-5 my-1">
                        <div class="row text-xl-start text-center">
                            <div class="row text-xl-start text-center">
                                <div class="col-12 profile_type">Phone</div>
                                <div class="col-12 profile_content"><%= user.phone %></div>
                            </div>

                        </div>
                        <div class="row text-xl-start text-center">
                            <div class="col-12 profile_type">Email</div>
                            <div class="col-12 profile_content"><%= user.email %></div>
                        </div>
                        <div class="row text-xl-start text-center">
                            <div class="col-12 profile_type">Activation Status</div>
                            <% if(user.isActivated === false){ %>
                                <div style="color: red; cursor: pointer;" onclick="location.href='/activation'"
                                     class="col-12 profile_content">Activate
                                </div>
                            <% } else { %>
                                <div class="col-12 profile_content">Activated</div>
                            <% } %>
                        </div>
                        <div class="row text-xl-start text-center">
                            <div class="col-12 profile_type">Balance</div>
                            <div class="col-12 profile_content"><%= user.balance %>$
                                <button data-bs-toggle="modal" data-bs-target="#paypal" class="profile_balance_button">
                                    <span style="position: relative; top: -3px">+</span></button>
                            </div>
                        </div>
                    </div>
                    <div class="col-1"><i class="fa fa-solid fa-pencil" style="cursor: pointer"
                                          onclick="location.href='/profile/settings/<%= user.id %>'"></i>
                        <a style="cursor: pointer" onclick="location.href='/logout'"><i
                                    class="fa fa-solid fa-sign-out"></i></a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>
<br>
<div class="container">
    <ul class="nav nav-pills mx-3 mt-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link ">
                <% if (isOwner) { %>
                    My projects
                <% } else { %>
                    <%= user.nickname %>'s projects
                <% } %>
            </button>
        </li>


    </ul>
    <div class="contact-us-line  mb-3"></div>

    <div class="container ">
        <% projects.forEach(function(project) { %>
            <div class="card_profile">
                <div class="row">
                    <div class="col-1 card_profile_image_div " style="cursor: pointer"
                         onclick="location.href='/api/projects/<%= project._id %>'"><img
                                src="<%= project.image %>" alt=""></div>
                    <div class="col-10 card_profile_content_div ">
                        <div class="row" style="position:relative;">
                            <!--TITLE-->
                            <div
                                    class="col-12 card_profile_text_div "><span
                                        onclick="location.href='/api/projects/<%= project._id %>'"
                                        style="font-weight: 600; cursor: pointer"><%= project.title %></span>
                                <!--SHORTLY--> <br>
                                <%= project.shortly %>
                            </div>


                            <!--FONT AWESOMES-->
                            <div class="col-12">

                                <div class="card_profile_info_div">
                                    <i class="fa fa-star"></i><%= project.avgRate %>/10
                                </div>
                                <div class="card_profile_info_div">
                                    <i class="fa fa-dollar"></i><%= project.collected %>/<%= project.goal %>
                                </div>
                                <div class="card_profile_info_div">
                                    <i class="fa fa-comments"></i><%= project.numOfComments %>
                                </div>
                                <div class="card_profile_info_div">
                                    <i class="fa fa-eye"></i><%= project.visits %>
                                </div>
                                <div class="card_profile_info_div">
                                    <i class="fa fa-share-alt"></i>Share
                                </div>
                            </div>
                        </div>

                    </div>
                    <% if (isOwner) { %>
                    <div class="col-1 py-3">
                        <!--EDIT-->
                        <i style="cursor: pointer" onclick="editConfirm()" class="fa fa-solid fa-pencil"></i>

                        <!--DELETE-->
                        <i style="cursor: pointer" onclick="deleteConfirm()" class="fa fa-solid fa-trash"></i>
                    </div>
                    <% } %>
                </div>

            </div>
            <br>
            <script>
                function editConfirm() {
                    if (confirm("If any data is changed, your project will be processed by moderation again and will become private")) {
                        location.href = '<%= url %>/api/projects/edit/<%= project._id %>'
                    }
                }

                function deleteConfirm() {
                    if (confirm("Are you sure you want to delete the project? There will be no turning back...")) {
                        location.href = '<%= url %>/api/projects/delete/<%= project._id %>'
                    }
                }
            </script>
        <% }) %>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="changePhoto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <div class="modal-header">
                <h5 class="modal-title">Change profile image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <br>
            <form action="/files/profile" method="POST" enctype="multipart/form-data">
                <label for="ava" class="text-white"></label>
                <input type="file" name="ava" accept="image/*">
                <button type="submit" class="btn border">Upload Image</button>
                <br>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="paypal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Top Up</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="/pay">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="message-text" class="col-form-label">Amount:</label>
                        <input type="number" class="profile_input" name="amount">
                        <button type="submit" class="btn btn-success">Confirm</button>

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>

</body>
</html>